var __reflect=(this&&this.__reflect)||function(p,c,t){p.__class__=c,t?t.push(c):t=[c],p.__types__=p.__types__?t.concat(p.__types__):t};var mouse;(function(mouse){var MouseEvent=(function(){function MouseEvent(){}MouseEvent.MOUSE_MOVE="mouseMove";MouseEvent.MOUSE_OVER="mouseOver";MouseEvent.MOUSE_OUT="mouseOut";MouseEvent.ROLL_OVER="rollOver";MouseEvent.ROLL_OUT="rollOut";MouseEvent.MOUSE_WHEEL="mouseWheel";return MouseEvent}());mouse.MouseEvent=MouseEvent;__reflect(MouseEvent.prototype,"mouse.MouseEvent")})(mouse||(mouse={}));egret.DisplayObject.prototype["$getConcatenatedVisible"]=function(){if(this.$parent){var parentVisible=this.$parent.$getConcatenatedVisible();return parentVisible&&this.$visible}else{return this.$visible}};var mouse;var checkTimeId;(function(mouse){var currentTarget;var stageObj;var isPC;var dispatch=function(type,bubbles,x,y){if(type==mouse.MouseEvent.ROLL_OVER&&currentTarget.isRollOver){return}if(type==mouse.MouseEvent.ROLL_OVER){currentTarget.isRollOver=true}else{if(type==mouse.MouseEvent.ROLL_OUT){delete currentTarget.isRollOver}}if(isPC&&currentTarget["buttonModeForMouse"]){try{var canvas=stageObj.$displayList.renderBuffer.surface;if(type==mouse.MouseEvent.ROLL_OVER){canvas.style.cursor="pointer"}else{if(type==mouse.MouseEvent.ROLL_OUT){canvas.style.cursor="auto"}}}catch(e){}}egret.TouchEvent.dispatchTouchEvent(currentTarget,type,bubbles,false,x,y,null)};var mouseX=NaN;var mouseY=NaN;var check=function(x,y){if(currentTarget&&!currentTarget.$stage){dispatch(mouse.MouseEvent.MOUSE_OUT,true,x,y);dispatch(mouse.MouseEvent.ROLL_OUT,false,x,y);currentTarget=null}var result=stageObj.$hitTest(x,y);if(result!=null&&result!=stageObj){if(!currentTarget){currentTarget=result;dispatch(mouse.MouseEvent.ROLL_OVER,false,x,y);dispatch(mouse.MouseEvent.MOUSE_OVER,true,x,y)}else{if(result!=currentTarget){dispatch(mouse.MouseEvent.MOUSE_OUT,true,x,y);dispatch(mouse.MouseEvent.ROLL_OUT,false,x,y);currentTarget=result;dispatch(mouse.MouseEvent.ROLL_OVER,false,x,y);dispatch(mouse.MouseEvent.MOUSE_OVER,true,x,y)}}}else{if(currentTarget){dispatch(mouse.MouseEvent.MOUSE_OUT,true,x,y);dispatch(mouse.MouseEvent.ROLL_OUT,false,x,y);currentTarget=null}}};mouse.enable=function(stage){isPC=egret.Capabilities.os=="Windows PC"||egret.Capabilities.os=="Mac OS";stageObj=stage;if(isPC){addMouseWheelEvent()}var onTouchMove=egret.sys.TouchHandler.prototype.onTouchMove;egret.sys.TouchHandler.prototype.onTouchMove=function(x,y,touchPointID){mouseX=x;mouseY=y;onTouchMove.call(this,x,y,touchPointID);if(mouseMoveEnabled){var target=stageObj.$hitTest(x,y);if(!target){target=stageObj}egret.TouchEvent.dispatchTouchEvent(target,mouse.MouseEvent.MOUSE_MOVE,true,true,x,y,touchPointID,true)}check(x,y)};var onTouchBegin=egret.sys.TouchHandler.prototype.onTouchBegin;egret.sys.TouchHandler.prototype.onTouchBegin=function(x,y,touchPointID){onTouchBegin.call(this,x,y,touchPointID);check(x,y)};var isMove=false;var getLocation=egret["web"].WebTouchHandler.prototype.getLocation;egret["web"].WebTouchHandler.prototype.getLocation=function(event){if(event.buttons==0){isMove=true}return getLocation.call(this,event)};var onTouchEnd=egret.sys.TouchHandler.prototype.onTouchEnd;egret.sys.TouchHandler.prototype.onTouchEnd=function(x,y,touchPointID){if(isMove){isMove=false;mouseX=x;mouseY=y;onTouchEnd.call(this,x,y,touchPointID);if(mouseMoveEnabled){var target=stageObj.$hitTest(x,y);if(!target){target=stageObj}egret.TouchEvent.dispatchTouchEvent(target,mouse.MouseEvent.MOUSE_MOVE,true,true,x,y,touchPointID,true)}return}onTouchEnd.call(this,x,y,touchPointID);check(x,y)};checkTimeId=setInterval(function(){if(mouseX!=NaN&&mouseY!=NaN){check(mouseX,mouseY)}},50)};mouse.stop=function(){if(checkTimeId>0){clearInterval(checkTimeId)}checkTimeId=0};mouse.restart=function(){if(checkTimeId==0){checkTimeId=setInterval(function(){if(mouseX!=NaN&&mouseY!=NaN){check(mouseX,mouseY)}},50)}};mouse.setButtonMode=function(displayObjcet,buttonMode){displayObjcet["buttonModeForMouse"]=buttonMode};var mouseMoveEnabled=false;mouse.setMouseMoveEnabled=function(enabled){mouseMoveEnabled=enabled};var addMouseWheelEvent=function(){var type="mousewheel";var _eventCompat=function(event){var type=event.type;if(type=="DOMMouseScroll"||type=="mousewheel"){event.delta=event.wheelDelta?event.wheelDelta:-(event.detail||0);stageObj.dispatchEventWith(mouse.MouseEvent.MOUSE_WHEEL,false,event.delta)}};if(window.addEventListener){if(type==="mousewheel"&&document["mozFullScreen"]!==undefined){type="DOMMouseScroll"}window.addEventListener(type,function(event){_eventCompat(event)},false)}else{if(window["attachEvent"]){window["attachEvent"]("on"+type,function(event){event=event||window.event;_eventCompat(event)})}}}})(mouse||(mouse={}));window.mouse = mouse;